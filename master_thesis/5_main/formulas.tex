\section{Формули}

\begin{equation*}
  Z = <T, K, \tau, g, q>
\end{equation*}

\begin{equation*}
  \tau \subset T^2
\end{equation*}

\begin{equation*}
  g: \tau \times K^2 \rightarrow \mathbb{R}
\end{equation*}

\begin{equation*}
  q: T \times K \rightarrow \mathbb{R}
\end{equation*}

\begin{equation*}
  \vec{k}^* = \argmax\limits_{\vec{k} \in K} \left\{
    \sum_{tt' \in \tau} g_{tt'}\left( k_{t}, k_{t'} \right) +
    \sum_{t \in T} q_{t} \left( k_{t} \right)
  \right\}
\end{equation*}

\begin{equation*}
  \begin{split}
    E\left( Z \right) =
      \sum_{tt' \in \tau} \max\limits_{k, k' \in K}{
        \left\{g_{tt'}\left( k_{t}, k'_{t'} \right)\right\}} +
      \sum_{t \in T} \max\limits_{k \in K}{
        \left\{q_{t} \left( k_{t} \right)\right\}}
    \ge \\ \ge
      \max\limits_{k \in K}{\left\{
        \sum_{tt' \in \tau} g_{tt'}\left( k_{t}, k_{t'} \right) +
      \sum_{t \in T} q_{t} \left( k_{t} \right)\right\}}
  \end{split}
\end{equation*}

\section{Задача}

\begin{equation*}
  \Phi = \left\{ \varphi_{tt'}\left( k \right) \mid
                t \in T, k \in K, t' \in N\left( t \right)\right\}
\end{equation*}

\begin{equation*}
  g'_{tt'} \left( k_{t}, k'_{t'} \right) = g_{tt'} \left( k_{t}, k'_{t'} \right)
    + \varphi_{tt'}\left( k \right) + \varphi_{t't}\left( k' \right)
\end{equation*}

\begin{equation*}
  q'_{t} \left( k_{t} \right) = q_{t}\left( k_{t} \right)
    - \sum_{t' \in N\left( t \right)} \varphi_{tt'} \left( k \right)
\end{equation*}

\begin{equation*}
  \begin{split}
    E\left( \Phi \right) =
      \sum_{tt' \in \tau} \max\limits_{k, k' \in K}{
        \left\{g_{tt'}\left( k_{t}, k'_{t'} \right) +
        \varphi_{tt'}\left( k \right) + \varphi_{t't}\left( k' \right)
      \right\}} + \\ +
      \sum_{t \in T} \max\limits_{k \in K}{
        \left\{q_{t} \left( k_{t} \right) -
        \sum_{t' \in N\left( t \right)} \varphi_{tt'} \left( k \right)\right\}}
    \rightarrow min
  \end{split}
\end{equation*}

\section{Розв'язок}

\begin{equation*}
  \begin{split}
    k_{t}^{q}
      =& \argmax\limits_{k \in K}{
        \left\{q_{t} \left( k_{t} \right)\right\}} \\
    \left( k_{t}^{g}, k_{t'}^{g} \right)
      =& \argmax\limits_{k, k' \in K}{
        \left\{g_{tt'}\left( k_{t}, k'_{t'} \right)\right\}}
  \end{split}
\end{equation*}

\begin{equation*}
  \frac{\partial E\left( \Phi \right)}{\partial \varphi_{tt'}\left( k \right)} =
  \begin{cases}
    1,& k_{t}^{g} = k \neq k_{t}^{q} \\
    -1,& k_{t}^{g} \neq k = k_{t}^{g} \\
    0,& otherwise
  \end{cases}
\end{equation*}

\begin{algorithm}
  \caption{Крок}
  \begin{algorithmic}[1]
    \FORALL{$\left( t, t' \right) \in \tau$}
      \STATE $\left( k, k' \right) \gets \argmax\limits_{k, k' \in K}{
          \left\{g_{tt'}\left( k_{t}, k'_{t'} \right) +
          \varphi_{tt'}\left( k \right) + \varphi_{t't}\left( k' \right)
        \right\}}$
      \STATE $\varphi_{tt'}\left( k \right)
        \gets \varphi_{tt'}\left( k \right) - \gamma_{i}$
      \STATE $\varphi_{t't}\left( k' \right)
        \gets \varphi_{t't}\left( k' \right) - \gamma_{i}$
    \ENDFOR
    \FORALL{$t \in T$}
      \STATE $k \gets \argmax\limits_{k \in K}{\left\{
          q_{t} \left( k_{t} \right) -
              \sum_{t' \in N\left( t \right)} \varphi_{tt'} \left( k \right)
        \right\}}$
      \FORALL{$t' \in N\left( t \right)$}
        \STATE $\varphi_{tt'}\left( k \right)
          \gets \varphi_{tt'}\left( k \right) + \gamma_{i}$
      \ENDFOR
    \ENDFOR
  \end{algorithmic}
\end{algorithm}

